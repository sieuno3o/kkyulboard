{% extends "layout.html" %}
{% block title %}Index{% endblock %}
{% block head %}

{% endblock %}
{% block content %}
    <div class="container">
        
        <div>
            <div class="row mt-4">
                <div class="col align-items-center d-flex">
                    <div class="board-text-line">
                        <h2>ì¡°íšŒ ê²°ê³¼</h2>
                        <h2 class="post-count">{{ postsCount }}</h2>
                        <h2>ê±´</h2>
                        <h3>/ ì´ {{ pag.total }}ê±´</h3>
                    </div>
                </div>

                <div class="col justify-content-end d-flex">
                    <div class="col mb-2 justify-content-end d-flex">
                        <select id="sort-by-select" class="form-select form-select-color-custom form-select-size-custom"
                                aria-label="">
                            <option value="recent" {% if sort=='recent' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
                            <option value="old" {% if sort=='old' %}selected{% endif %}>ì˜¤ë˜ëœìˆœ</option>
                            <option value="click" {% if sort=='click' %}selected{% endif %}>ì¡°íšŒìˆœ</option>
                        </select>
                    </div>

                    {% if isLogin %}
                        <a href="{{ url_for('board.createPost') }}" class="btn btn-theme-color ms-3 mb-2">ê¸€ì‘ì„±</a>
                    {% endif %}
                    <a href="{{ url_for('board.index') }}" class="btn btn-primary mb-2 ms-3">ê²€ìƒ‰ ì´ˆê¸°í™”</a>
                </div>
            </div>

            <table class="table postTable table-bordered">
                <thead>
                <tr>
                    <th class="postNum">ê²Œì‹œê¸€ ë²ˆí˜¸</th>
                    <th class="postTitle">ì œëª©</th>
                    <th class="postWriter">ì‘ì„±ì</th>
                    <th class="postDate">ì‘ì„±ì¼</th>
                    <th class="postHit">ì¡°íšŒìˆ˜</th>
                </tr>
                </thead>
                <tbody class="text-center">
                {% for notice in notices %}
                    <tr class="noticePost">
                        <td>{% if notice.secret_mode %}ğŸ“¢ ì„ì›ê³µì§€{% else %}ğŸ“¢ ê³µì§€{% endif %}</td>
                        <td style="text-align: left;">
                            <a class="board-td-custom" href="{{ url_for('board.detail', post_id=notice.post_id)}}">{{ notice.title }}</a>
                            {% if notice.secret_mode %}ğŸ”’{% endif %}
                        </td>
                        <td>{{ notice.user.username }}</td>
                        <td>{{ notice.updated_at.strftime("%Y-%m-%d %H:%M") }}</td>
                        <td>{{ notice.click_count }}</td>
                    </tr>
                {% endfor %}
                {% for post in pag.items %}
                    <tr>
                        <td>{{ stIdx - loop.index0 }}</td>
                        <td style="text-align: left;">
                            <a class="board-td-custom" href="{{ url_for('board.detail', post_id=post.post_id)}}">{{ post.title }}</a>
                            {% if post.secret_mode %}ğŸ”’{% endif %}
                        </td>
                        <td>{{ post.user.username }}</td>
                        <td>{{ post.updated_at.strftime("%Y-%m-%d %H:%M") }}</td>
                        <td>{{ post.click_count }}</td>
                    </tr>
                {% endfor %}

                </tbody>
            </table>
        </div>
        
        <form>
            <div class="row">
                <div class="col-lg-2">
                    <select name="cate" class="form-select form-select-color-custom form-select-size-custom" aria-label="" style="width: 100%;">
                        <option value="title" {% if cate=='title' %}selected{% endif %}>ì œëª©</option>
                        <option value="writer" {% if cate=='writer' %}selected{% endif %}>ì‘ì„±ì</option>
                        <option value="content" {% if cate=='content' %}selected{% endif %}>ë‚´ìš©</option>
                    </select>
                </div>
                <div class="col-lg-8">
                    <input type="text" name="keyword" value="{{keyword}}" class="form-control">
                </div>
                <div class="col-lg-2">
                    <button class="btn btn-theme-color" style="width: 100%;">ê²€ìƒ‰</button>
                </div>
            </div>
        </form>


        <div class="page-nav mt-4">
            <div class="col justify-content-center d-flex align-items-center">
                <!-- Pagination Links -->
                {% if pag.has_prev %}
                    <a class="page-nav-item" href="{{ url_for('board.index', page=pag.prev_num, sort=sort, cate=cate, keyword=keyword) }}"><</a>
                {% endif %}

                {% for page_num in pag.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != pag.page %}
                            <a class="page-nav-item" href="{{ url_for('board.index', page=page_num, sort=sort, cate=cate, keyword=keyword) }}">{{ page_num }}</a>
                        {% else %}
                            <a class="page-nav-item-current">{{ page_num }}</a>
                        {% endif %}
                    {% else %}
                        ...
                    {% endif %}
                {% endfor %}

                {% if pag.has_next %}
                    <a class="page-nav-item" href="{{ url_for('board.index', page=pag.next_num, sort=sort, cate=cate, keyword=keyword) }}">></a>
                {% endif %}
            </div>
        </div>






    </div> <!-- /container -->

    <script>
        // select ìš”ì†Œì—ì„œ ë³€ê²½ì´ ì¼ì–´ë‚  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        var selectElement = document.getElementById('sort-by-select');
        selectElement.addEventListener('change', function (event) {
            // ì„ íƒëœ ì˜µì…˜ì˜ ê°’ì„ ê°€ì ¸ì˜´
            let redirectTo = `index?page={{pag.page}}&sort=${event.target.value}&cate={{cate}}&keyword={{keyword}}`;
            window.location.href = redirectTo;
        });
    </script>
{% endblock %}

