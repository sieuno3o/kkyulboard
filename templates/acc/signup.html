{% extends "layout.html" %}
{% block title %}SIGNUP PAGE{% endblock %}
{% block head %}

{% endblock %}
{% block content %}
<style scoped>
    .signup-center {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #signupForm {
        flex-direction: column;
    }

    .customInput {
        width: 300px;
        margin-top: -20px;
    }

    .file-input-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #imagePreview {
        width: 100px; 
        height: 100px;
        margin-left: -100px;
        display: none;
    }

    .file-input-text {
        font-family: 'EF_jejudoldam';
        font-size: larger;
    }

    .profile-text {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        font-family: 'EF_jejudoldam';
        font-size: larger;
        margin-bottom: 12px;
    }
</style>

<div class="signup-center customLogo loginLogoBox textOrange">
    <img class="navbarLogo marginRight16" src="/static/kkyul.png" alt="ğŸŠ">
    <span style="font-family: 'EF_jejudoldam'">ë€° íšŒì›ê°€ì…</span>
    <img class="navbarLogo marginLeft16" src="/static/kkyul.png" alt="ğŸŠ">
</div>
<form id="signupForm" class="signup-center" method="post" enctype="multipart/form-data">
    <span class="regNameState"></span><br>
    <input type="text" class="customInput" name="regName" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"><br>
    <input type="password" class="customInput" name="regPass" placeholder="íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”"><br>
    <input type="password" class="customInput" name="chkPass" placeholder="íŒ¨ìŠ¤ì›Œë“œë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”"><br>
    <span class="regMailState"></span><br>
    <input type="email" name="regMail" class="customInput" placeholder="ì´ë©”ì¼ì„ í˜•ì‹ì— ë§ì¶° ì‘ì„±í•´ ì£¼ì„¸ìš”"><br>
    <div class="file-input-container">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <span class="profile-text textOrange">í”„ë¡œí•„ ì‚¬ì§„</span>
            <div style="display: flex; flex-direction: row;">
                <input type="file" name="regPic" id="regPic" onchange="previewFile()"> 
                <img id="imagePreview"> 
            </div>
        </div>
    </div>
    <textarea name="regCom" class="customInput" style="margin-top: 40px;" placeholder="ì†Œê°œê¸€ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."></textarea>
    <button type="button" style="width: 300px;" class="button2 marginTop16" onclick="signupCheck()">íšŒì›ê°€ì…</button>
</form>

<script>
    const usernameInput = document.querySelector('input[name="regName"]');
    const usermailInput = document.querySelector('input[name="regMail"]');
    const usernameState = document.querySelector('.regNameState');
    const usermailState = document.querySelector('.regMailState');
    const userpassInput = document.querySelector('input[name="regPass"]');
    const userchkpassInput = document.querySelector('input[name="chkPass"]');

    function isValidEmail(email) {
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailPattern.test(email);
    }

    let usernameBool = false;
    let usermailBool = false;

    usernameInput.addEventListener('keyup', function () {
        const username = usernameInput.value.trim();
        if (username.length > 4) {
            fetch('/acc/checkNameDup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username: username })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.isDuplicate) {
                        usernameState.innerHTML = "ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                        usernameBool = false;
                    } else {
                        usernameState.innerHTML = "ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                        usernameBool = true;
                    }
                })
                .catch(error => console.error('Error:', error));
        } else {
            usernameState.innerHTML = "ì•„ì´ë””ëŠ” 5ìë¦¬ ì´ìƒìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.";
            usernameBool = false;
        }
    });

    usermailInput.addEventListener('keyup', function () {
        const usermail = usermailInput.value.trim();
        if (!isValidEmail(usermail)) {
            usermailState.innerHTML = "ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.";
            usermailBool = false;
        } else {
            fetch('/acc/checkMailDup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email: usermail })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.isDuplicate) {
                        usermailState.innerHTML = "ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                        usermailBool = false;
                    } else {
                        usermailState.innerHTML = "ì‚¬ìš©ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                        usermailBool = true;
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        const passwordModal = new bootstrap.Modal(document.getElementById('passwordModal'));
        passwordModal.hide();
    });

    function previewFile() {
            const preview = document.getElementById('imagePreview'); 
            const file = document.getElementById('regPic').files[0]; 
            const reader = new FileReader();

            reader.onloadend = function () {
                preview.src = reader.result; 
                preview.style.display = 'block';
            };

            if (file) {
                reader.readAsDataURL(file); 
            } else {
                preview.src = "";
                preview.style.display = 'none';
            }
        }

    function signupCheck() {
        const username = usernameInput.value.trim();
        const usermail = usermailInput.value.trim();
        const userpass = userpassInput.value.trim();
        const userchkpass = userchkpassInput.value.trim();
        if (!usernameBool) {
            alert("ì…ë ¥í•˜ì‹  ì•„ì´ë””ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”");
        } else if (userpass != userchkpass) {
            alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì„œë¡œ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        } else if (!usermailBool) {
            alert("ì…ë ¥í•˜ì‹  ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”");
        } else {
            document.getElementById("signupForm").submit();
        }
    }
    // íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ë€ì—ì„œ Enter í‚¤ ì…ë ¥ ê°ì§€
    document.getElementById('passwordInput').addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
            validatePassword(); // íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ í•¨ìˆ˜ í˜¸ì¶œ
        }
    });

    // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    document.querySelector('.modal-footer .btn-primary').addEventListener('click', function () {
        validatePassword(); // íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ í•¨ìˆ˜ í˜¸ì¶œ
    });

        function previewFile() {
        const preview = document.getElementById('imagePreview'); // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œ
        const file = document.getElementById('regPic').files[0]; // ì„ íƒëœ íŒŒì¼
        const reader = new FileReader();

        reader.onloadend = function () {
            preview.src = reader.result; // íŒŒì¼ì˜ ë‚´ìš©ì„ ì½ì€ ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°ì˜ ì†ŒìŠ¤ë¡œ ì„¤ì •
            preview.style.display = 'block'; // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        };

        if (file) {
            reader.readAsDataURL(file); // íŒŒì¼ì„ Data URL í˜•ì‹ìœ¼ë¡œ ì½ìŒ
        } else {
            preview.src = "";
            preview.style.display = 'none'; // íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€
        }
    }
</script>
{% endblock %}